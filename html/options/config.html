<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>ATND Notify Config</title>
	<link rel="stylesheet" href="css/screen.css" type="text/css" media="screen" title="default" />
	<!--  jquery core -->
	<script src="js/jquery/jquery-1.4.1.min.js" type="text/javascript"></script>

	<!--  checkbox styling script -->
	<script src="js/jquery/jquery.bind.js" type="text/javascript"></script>
	<script src="js/jquery/jquery.selectbox-0.5_style_2.js" type="text/javascript"></script>
	<script type="text/javascript" src="/js/atnd.js"></script>
	<script src="js/jquery/custom_jquery.js" type="text/javascript"></script>
	<script type="text/javascript">
	$(function(){
		var host = 'chrome-extension://' + location.host + '/html/options/';
		$("#news").attr("href", host + 'news.html');
		$("#about").attr("href", host + 'about.html');

		var options = chrome.extension.getBackgroundPage().options;
		//console.log(options);
		$('#nickname').val(options.nickname);
		$('#autoCloseTimeSS').val(options.autoCloseTimeSS);
		if (options.eventList.length != 0) {
			$('#event_id').val(options.eventList[0].event_id);
		}
		$('#timerMI').val(options.timerMI);
		$.each(options.notifyList, function (i, e) {
			$('#notify' + e).attr('checked', 'checked');
		});

		function getNotifyList() {
			var result = [];
			$("input[type='checkbox']").each(function (i, e) {
				if ($(e).is(':checked')) {
				  result.push($(e).val());
				}
			});
			return result;
		}

		$('#saveBtn').click(function () {
			if (!validate()) {
				$("#message-success").fadeOut();
				return;
			}
			options.nickname = $('#nickname').val();
			var event_id = $('#event_id').val();
			options.eventList = [];
			var now = new Date();
			var atnd = new Atnd(event_id);
			var event = atnd.getEvent();
			if (event) {
				console.log(event.title);
				$("#eventTitle").text("[" + event.title + "]の予定を通知します");
			} else {
				$("#eventTitle").text("");
			}
			var status = atnd.getStatus(options.nickname) || 0;
			//console.debug("status:" + status);
			options.eventList.push({'event_id': event_id, status:status, updated_at:now.toISOString().substring(0,10) + "T" + now.toLocaleTimeString(), notifyZumiList:[]});
			options.timerMI = $('#timerMI').val();
			options.autoCloseTimeSS = $('#autoCloseTimeSS').val();
			options.notifyList = getNotifyList();
			chrome.extension.getBackgroundPage().options = options;
			chrome.extension.getBackgroundPage().restart();

			$("#message-success").fadeOut(function () {
				$(this).fadeIn();
			});
		});

		function validate() {
			var isError = false;
			if (isNaN($('#event_id').val())) {
				$('#event_id').addClass('inp-form-error');
				$('#event_id_error').show();
				isError = true;
			} else {
				$('#event_id').removeClass('inp-form-error');
				$('#event_id_error').hide();
			}
			if ($('#nickname').val().length == 0) {
				$('#nickname').addClass('inp-form-error');
				$('#nickname_error').show();
				isError = true;
			} else {
				$('#nickname').removeClass('inp-form-error');
				$('#nickname_error').hide();
			}
			return !isError;
		}
	});
	</script>
</head>
<body>
<div id="page-top-outer">
	<div id="page-top">
		<div id="logo">
		<a href=""><img src="images/shared/logo.png" width="156" height="40" alt="" /></a>
		</div>
	</div>
</div>
<div class="clear">&nbsp;</div>

<!--  start nav-outer-repeat................................................. START -->
<div class="nav-outer-repeat">
<!--  start nav-outer -->
<div class="nav-outer">
	<div class="nav">
		<div class="table">
			<ul class="current"><li><a href="#nogo"><b>Config</b></a></li></ul>
			<div class="nav-divider">&nbsp;</div>
			<ul class="select"><li><a id="news" href="#nogo"><b>News</b></a></li></ul>
			<div class="nav-divider">&nbsp;</div>
			<ul class="select"><li><a id="about" href="#nogo"><b>About</b></a></li></ul>
			<div class="nav-divider">&nbsp;</div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
</div>
<div class="clear"></div>
<!--  start nav-outer -->
</div>
<!--  start nav-outer-repeat................................................... END -->

 <div class="clear"></div>

<!-- start content-outer -->
<div id="content-outer">
<!-- start content -->
<div id="content">

<div id="page-heading"><h1>ATND Notifyの設定</h1></div>

	<table border="0" width="100%" cellpadding="0" cellspacing="0" id="content-table">
	<tr>
		<th rowspan="3" class="sized"><img src="images/shared/side_shadowleft.jpg" width="20" height="300" alt="" /></th>
		<th class="topleft"></th>
		<td id="tbl-border-top">&nbsp;</td>
		<th class="topright"></th>
		<th rowspan="3" class="sized"><img src="images/shared/side_shadowright.jpg" width="20" height="300" alt="" /></th>
	</tr>
	<tr>
		<td id="tbl-border-left"></td>
		<td>
		<!--  start content-table-inner -->
		<div id="content-table-inner">

		<div id="message-success" style="display: none;">
			<table border="0" width="100%" cellpadding="0" cellspacing="0">
			<tr>
				<td class="green-left">Success. <span id="eventTitle"></span></td>
				<td class="green-right"><a class="close-green"><img src="images/table/icon_close_green.gif"   alt="" /></a></td>
			</tr>
			<tr>
				<td height="10"></td>
			</tr>
		</table>
		</div>

		<table border="0" width="100%" cellpadding="0" cellspacing="0">
		<tr valign="top">
		<td>
			<!-- start id-form -->
			<table border="0" cellpadding="0" cellspacing="0"  id="id-form">
			<tr>
				<th valign="top">ニックネーム:</th>
				<td><input type="text" id="nickname" class="inp-form" /></td>
				<td id="nickname_error" style="display: none;"><div class="error-left"></div><div class="error-inner">※入力して下さい。</div></td>
			</tr>
			<tr>
				<th valign="top">ATNDイベントID:</th>
				<td><input type="text" id="event_id" class="inp-form"  maxlength="6" /></td>
				<td id="event_id_error" style="display: none;"><div class="error-left"></div><div class="error-inner">※数字で入力して下さい。</div></td>
			</tr>
			<tr>
				<th valign="top">監視間隔:</th>
				<td>
				<select id="timerMI" class="" style="width:80px;">
					<option value="60">60分</option>
					<option value="30">30分</option>
					<option value="15">15分</option>
					<option value="5">5分</option>
					<option value="1">1分</option>
				</select>
				</td>
				<td></td>
			</tr>
			<tr>
				<th valign="top">通知ウィンドウを表示する時間:</th>
				<td>
				<select id="autoCloseTimeSS" class="" style="width:80px;">
					<option value="0">閉じない</option>
					<option value="60">60秒</option>
					<option value="30">30秒</option>
					<option value="15">15秒</option>
				</select>
				</td>
				<td></td>
			</tr>
			<tr>
				<th valign="top">イベントの予定日より何日前に通知するか？:</th>
				<td>
					<label for="notify1" style="color:black;">1日前</label><input type="checkbox" id="notify1" value="1" /><br/>
					<label for="notify2" style="color:black;">2日前</label><input type="checkbox" id="notify2" value="2" /><br/>
					<label for="notify3" style="color:black;">3日前</label><input type="checkbox" id="notify3" value="3" /><br/>
					<label for="notify4" style="color:black;">4日前</label><input type="checkbox" id="notify4" value="4" /><br/>
					<label for="notify5" style="color:black;">5日前</label><input type="checkbox" id="notify5" value="5" /><br/>
					<label for="notify6" style="color:black;">6日前</label><input type="checkbox" id="notify6" value="6" /><br/>
					<label for="notify7" style="color:black;">7日前</label><input type="checkbox" id="notify7" value="7" /><br/>
					<label for="notify10" style="color:black;">10日前</label><input type="checkbox" id="notify10" value="10" /><br/>
				</td>
				<td></td>
			</tr>
			<tr>
				<td></td>
			</tr>
			<tr>
				<th>&nbsp;</th>
				<td valign="top">
					<input type="button" id="saveBtn" value="" class="form-submit" />
				</td>
				<td></td>
			</tr>
			</table>
			<!-- end id-form  -->
		</td>
			<td>
			</td>
		</tr>
		<tr>
			<td><img src="images/shared/blank.gif" width="695" height="1" alt="blank" /></td>
			<td></td>
		</tr>
		</table>

		<div class="clear"></div>
		</div>
		<!--  end content-table-inner  -->
		</td>
		<td id="tbl-border-right"></td>
	</tr>
	<tr>
		<th class="sized bottomleft"></th>
		<td id="tbl-border-bottom">&nbsp;</td>
		<th class="sized bottomright"></th>
	</tr>
	</table>

	<div class="clear">&nbsp;</div>
</div>
<!--  end content -->
<div class="clear">&nbsp;</div>
</div>
<!--  end content-outer -->
<div class="clear">&nbsp;</div>
<div id="footer">
	<div id="footer-left">AtndNotify &copy; Copyright <a href="http://twitter.com/bluerabbit777jp" target="_blank">@bluerabbit777jp</a>. All rights reserved.</div>
	<div class="clear">&nbsp;</div>
</div>
</body>
</html>